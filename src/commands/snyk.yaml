# src/commands/snyk.yaml
# yamllint disable rule:line-length
---

description: |
  Snyk IaC static scan against terraform plan output json.

parameters:

  working-directory:
    description: specific folder in which to run the commands
    type: string
    default: '.'
  token-variable:
    description: >
      Name of env var containing your Snyk API token. Pass this as a raw string such as CICD_SNYK_TOKEN.
      Do not paste the actual token into your configuration.
      If omitted it's assumed the CLI has already been setup with a valid token beforehand.
    type: env_var_name
    default: SNYK_TOKEN
  organization:
    description: >
      Name of the Snyk organisation name, under which this project should be tested and monitored
      If omitted the default organization will be used.
    type: string
    default: ""
  snyk-additional-args:
    description: optional additional flags to be passed to Snyk IaC
    type: string
    default: ""

steps:
  - run:
      name: Run Snyk iac against terraform plan output json with optional additional args
      working_directory: << parameters.working-directory >>
      command: >
        snyk iac test tfplan.json
        <<#parameters.organization>>--org=<<parameters.organization>><</parameters.organization>>
        << parameters.snyk-additional-args >>
